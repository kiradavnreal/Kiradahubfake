-- Universal Fly GUI V4 (Với Bypass, Noclip, và Chỉnh Tốc Độ - Tên KiradaChan's Fly Hack)
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local PhysicsService = game:GetService("PhysicsService")

local player = Players.LocalPlayer
local mouse = player:GetMouse()

local flying = false
local noclip = false
local speed = 50
local playerName = "KiradaChan"  -- Tên hiển thị trong GUI

-- Bypass cơ bản: Hook __namecall để tránh detection (không 100%)
local oldNamecall
oldNamecall = hookmetamethod(game, "__namecall", function(self, ...)
    local method = getnamecallmethod()
    if method == "FireServer" or method == "InvokeServer" then
        if tostring(self) == "AntiCheat" or tostring(self):find("Detect") then
            return -- Bỏ qua nếu là anti-cheat event
        end
    end
    return oldNamecall(self, ...)
end)

-- Hàm tạo fly
local function createFly()
    local char = player.Character or player.CharacterAdded:Wait()
    local humanoidRootPart = char:WaitForChild("HumanoidRootPart")
    local humanoid = char:WaitForChild("Humanoid")
    
    local bv = Instance.new("BodyVelocity")
    bv.MaxForce = Vector3.new(1e9, 1e9, 1e9)  -- Tăng lực để bypass một số check
    bv.Velocity = Vector3.new(0, 0, 0)
    bv.Parent = humanoidRootPart
    
    local bg = Instance.new("BodyGyro")
    bg.MaxTorque = Vector3.new(1e9, 1e9, 1e9)
    bg.CFrame = humanoidRootPart.CFrame
    bg.Parent = humanoidRootPart
    
    humanoid.PlatformStand = true  -- Bypass fall damage
    
    return bv, bg
end

-- Hàm toggle noclip
local function toggleNoclip()
    local char = player.Character
    if char then
        for _, part in ipairs(char:GetDescendants()) do
            if part:IsA("BasePart") then
                if noclip then
                    PhysicsService:SetPartCollisionGroup(part, "NoClipGroup")
                else
                    PhysicsService:SetPartCollisionGroup(part, "Default")
                end
            end
        end
    end
end

-- Tạo CollisionGroup cho noclip (nếu chưa có)
if not PhysicsService:IsCollisionGroupRegistered("NoClipGroup") then
    PhysicsService:RegisterCollisionGroup("NoClipGroup")
    PhysicsService:CollisionGroupSetCollidable("NoClipGroup", "Default", false)
    PhysicsService:CollisionGroupSetCollidable("NoClipGroup", "NoClipGroup", false)
end

-- Tạo GUI
local screenGui = Instance.new("ScreenGui")
screenGui.Parent = player.PlayerGui
local frame = Instance.new("Frame", screenGui)
frame.Size = UDim2.new(0, 200, 0, 200)
frame.Position = UDim2.new(0, 10, 0, 10)
frame.BackgroundColor3 = Color3.new(0, 0, 0)
frame.BackgroundTransparency = 0.5
frame.Visible = false

local nameLabel = Instance.new("TextLabel", frame)
nameLabel.Size = UDim2.new(1, 0, 0.2, 0)
nameLabel.Text = playerName .. "'s Fly Hack"
nameLabel.TextColor3 = Color3.new(1, 1, 1)
nameLabel.BackgroundTransparency = 1

local speedLabel = Instance.new("TextLabel", frame)
speedLabel.Size = UDim2.new(1, 0, 0.2, 0)
speedLabel.Position = UDim2.new(0, 0, 0.2, 0)
speedLabel.Text = "Speed: " .. speed
speedLabel.TextColor3 = Color3.new(1, 1, 1)
speedLabel.BackgroundTransparency = 1

local upButton = Instance.new("TextButton", frame)
upButton.Size = UDim2.new(0.5, 0, 0.15, 0)
upButton.Position = UDim2.new(0, 0, 0.4, 0)
upButton.Text = "+"
upButton.TextColor3 = Color3.new(1, 1, 1)
upButton.BackgroundColor3 = Color3.new(0, 0.5, 0)

local downButton = Instance.new("TextButton", frame)
downButton.Size = UDim2.new(0.5, 0, 0.15, 0)
downButton.Position = UDim2.new(0.5, 0, 0.4, 0)
downButton.Text = "-"
downButton.TextColor3 = Color3.new(1, 1, 1)
downButton.BackgroundColor3 = Color3.new(0.5, 0, 0)

local noclipLabel = Instance.new("TextLabel", frame)
noclipLabel.Size = UDim2.new(1, 0, 0.2, 0)
noclipLabel.Position = UDim2.new(0, 0, 0.55, 0)
noclipLabel.Text = "Noclip: " .. (noclip and "ON" or "OFF")
noclipLabel.TextColor3 = Color3.new(1, 1, 1)
noclipLabel.BackgroundTransparency = 1

-- Xử lý nút tăng/giảm tốc độ
upButton.MouseButton1Click:Connect(function()
    speed = speed + 10
    speedLabel.Text = "Speed: " .. speed
end)

downButton.MouseButton1Click:Connect(function()
    speed = math.max(10, speed - 10)
    speedLabel.Text = "Speed: " .. speed
end)

-- Bật/tắt fly và noclip
UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.E then
        flying = not flying
        if flying then
            createFly()
            frame.Visible = true
        else
            if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                local hrp = player.Character.HumanoidRootPart
                if hrp:FindFirstChildOfClass("BodyVelocity") then
                    hrp:FindFirstChildOfClass("BodyVelocity"):Destroy()
                end
                if hrp:FindFirstChildOfClass("BodyGyro") then
                    hrp:FindFirstChildOfClass("BodyGyro"):Destroy()
                end
            end
            player.Character.Humanoid.PlatformStand = false
            frame.Visible = false
        end
    elseif input.KeyCode == Enum.KeyCode.F then  -- Nhấn F để toggle noclip
        noclip = not noclip
        toggleNoclip()
        noclipLabel.Text = "Noclip: " .. (noclip and "ON" or "OFF")
    end
end)

-- Loop điều khiển bay và noclip
RunService.Heartbeat:Connect(function()
    if flying and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        local bv = player.Character.HumanoidRootPart:FindFirstChildOfClass("BodyVelocity")
        if bv then
            local cam = workspace.CurrentCamera
            local dir = cam.CFrame.LookVector
            bv.Velocity = Vector3.new(dir.X * speed, 0, dir.Z * speed)
        end
    end
    if noclip then
        toggleNoclip()  -- Giữ noclip active mỗi frame
    end
end)
