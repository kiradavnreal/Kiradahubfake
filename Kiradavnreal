-- Script: Kirada Demo (C·∫≠p nh·∫≠t: X√≥a Auto Hit, Fix ƒêi Tr√™n N∆∞·ªõc cho m·ªçi game, Fix Ch·∫°y/Nh·∫£y, Ti·∫øng Vi·ªát)
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Terrain = workspace:WaitForChild("Terrain")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local rootPart = character:WaitForChild("HumanoidRootPart")

-- T·∫°o GUI Menu (Scrollable ngang)
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "KiradaDemo"
ScreenGui.Parent = player.PlayerGui
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- N√∫t Toggle Menu (Mobile/PC)
local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(0, 60, 0, 60)
toggleButton.Position = UDim2.new(0, 10, 0, 10)
toggleButton.BackgroundColor3 = Color3.fromRGB(34, 139, 34) -- Xanh l√°
toggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleButton.Text = "üå≤"
toggleButton.TextScaled = true
toggleButton.Font = Enum.Font.SourceSansBold
toggleButton.Parent = ScreenGui
toggleButton.Name = "ToggleButton"

local toggleCorner = Instance.new("UICorner")
toggleCorner.CornerRadius = UDim.new(0, 15)
toggleCorner.Parent = toggleButton

-- Frame ch√≠nh
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 600, 0, 250)
mainFrame.Position = UDim2.new(0.5, -300, 0.5, -125)
mainFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
mainFrame.BackgroundTransparency = 0.3
mainFrame.BorderSizePixel = 0
mainFrame.Visible = false
mainFrame.Parent = ScreenGui

local mainCorner = Instance.new("UICorner")
mainCorner.CornerRadius = UDim.new(0, 12)
mainCorner.Parent = mainFrame

local gradient = Instance.new("UIGradient")
gradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(0, 100, 0)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(0, 50, 0))
})
gradient.Rotation = 45
gradient.Parent = mainFrame

local scrollingFrame = Instance.new("ScrollingFrame")
scrollingFrame.Size = UDim2.new(1, 0, 1, 0)
scrollingFrame.Position = UDim2.new(0, 0, 0, 0)
scrollingFrame.BackgroundTransparency = 1
scrollingFrame.BorderSizePixel = 0
scrollingFrame.ScrollBarThickness = 8
scrollingFrame.ScrollBarImageColor3 = Color3.fromRGB(34, 139, 34)
scrollingFrame.CanvasSize = UDim2.new(2, 0, 0, 0)
scrollingFrame.ScrollingDirection = Enum.ScrollingDirection.X
scrollingFrame.Parent = mainFrame

-- H√†m t·∫°o TextBox
local function createTextBox(name, position, placeholder)
    local textBox = Instance.new("TextBox")
    textBox.Size = UDim2.new(0, 120, 0, 40)
    textBox.Position = position
    textBox.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    textBox.TextColor3 = Color3.fromRGB(255, 255, 255)
    textBox.PlaceholderText = placeholder
    textBox.Text = ""
    textBox.TextScaled = true
    textBox.Font = Enum.Font.SourceSans
    textBox.Parent = scrollingFrame
    textBox.Name = name
    
    local tbCorner = Instance.new("UICorner")
    tbCorner.CornerRadius = UDim.new(0, 8)
    tbCorner.Parent = textBox
    
    return textBox
end

-- H√†m t·∫°o Button v·ªõi hover
local function createButton(name, position, text)
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(0, 120, 0, 40)
    button.Position = position
    button.BackgroundColor3 = Color3.fromRGB(34, 139, 34)
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.Text = text
    button.TextScaled = true
    button.Font = Enum.Font.SourceSansBold
    button.Parent = scrollingFrame
    button.Name = name
    
    local btnCorner = Instance.new("UICorner")
    btnCorner.CornerRadius = UDim.new(0, 8)
    btnCorner.Parent = button
    
    button.MouseEnter:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(50, 160, 50)}):Play()
    end)
    button.MouseLeave:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(34, 139, 34)}):Play()
    end)
    
    return button
end

-- T·∫°o giao di·ªán ngang
local titleLabel = Instance.new("TextLabel")
titleLabel.Size = UDim2.new(0, 580, 0, 40)
titleLabel.Position = UDim2.new(0, 10, 0, 10)
titleLabel.BackgroundTransparency = 1
titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
titleLabel.Text = "üå≤ Kirada Demo Menu üå≤"
titleLabel.TextScaled = true
titleLabel.Font = Enum.Font.SourceSansBold
titleLabel.Parent = scrollingFrame

local speedButton = createButton("SpeedButton", UDim2.new(0, 10, 0, 60), "ƒê·∫∑t T·ªëc ƒê·ªô")
local speedInput = createTextBox("SpeedInput", UDim2.new(0, 140, 0, 60), "T·ªëc ƒë·ªô (VD: 100)")

local jumpButton = createButton("JumpButton", UDim2.new(0, 270, 0, 60), "ƒê·∫∑t Nh·∫£y")
local jumpInput = createTextBox("JumpInput", UDim2.new(0, 400, 0, 60), "Nh·∫£y (VD: 50)")

local teleportButton = createButton("TeleportButton", UDim2.new(0, 530, 0, 60), "D·ªãch Chuy·ªÉn")
local teleportInput = createTextBox("TeleportInput", UDim2.new(0, 660, 0, 60), "T√™n ng∆∞·ªùi ch∆°i")

local noclipToggle = createButton("NoclipToggle", UDim2.new(0, 10, 0, 110), "Xuy√™n T∆∞·ªùng: T·∫ÆT")
local godModeToggle = createButton("GodModeToggle", UDim2.new(0, 140, 0, 110), "B·∫•t T·ª≠: T·∫ÆT")
local espToggle = createButton("EspToggle", UDim2.new(0, 270, 0, 110), "ESP: T·∫ÆT")
local hitboxToggle = createButton("HitboxToggle", UDim2.new(0, 400, 0, 110), "Hitbox: T·∫ÆT")
local waterWalkToggle = createButton("WaterWalkToggle", UDim2.new(0, 530, 0, 110), "ƒêi Tr√™n N∆∞·ªõc: T·∫ÆT")

-- Bi·∫øn tr·∫°ng th√°i
local isNoClip = false
local isGodMode = false
local isESP = false
local isHitbox = false
local isWaterWalk = false
local customWalkSpeed = 16 -- Gi√° tr·ªã m·∫∑c ƒë·ªãnh
local customJumpPower = 50 -- Gi√° tr·ªã m·∫∑c ƒë·ªãnh
local noclipConnection = nil
local espConnections = {}
local hitboxParts = {}
local waterWalkConnection = nil
local speedJumpConnection = nil
local waterPlatform = nil

-- H√†m th√¥ng b√°o
local function notify(message)
    game.StarterGui:SetCore("SendNotification", {
        Title = "Kirada Demo",
        Text = message,
        Duration = 3
    })
end

-- Toggle Menu
toggleButton.MouseButton1Click:Connect(function()
    mainFrame.Visible = not mainFrame.Visible
    if mainFrame.Visible then
        TweenService:Create(mainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Back), {Position = UDim2.new(0.5, -300, 0.5, -125)}):Play()
    else
        TweenService:Create(mainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Back), {Position = UDim2.new(0.5, -300, 1, 0)}):Play()
    end
end)

UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if not gameProcessed and input.KeyCode == Enum.KeyCode.M then
        toggleButton.MouseButton1Click:Fire()
    end
end)

-- X·ª≠ l√Ω t·ªëc ƒë·ªô (Set v√† loop ƒë·ªÉ override)
speedButton.MouseButton1Click:Connect(function()
    local speed = tonumber(speedInput.Text)
    if speed then
        customWalkSpeed = math.clamp(speed, 0, 1000)
        notify("ƒê√£ ƒë·∫∑t t·ªëc ƒë·ªô: " .. customWalkSpeed)
    else
        notify("Vui l√≤ng nh·∫≠p s·ªë h·ª£p l·ªá cho t·ªëc ƒë·ªô!")
    end
end)

-- X·ª≠ l√Ω nh·∫£y (Set v√† loop ƒë·ªÉ override)
jumpButton.MouseButton1Click:Connect(function()
    local jumpPower = tonumber(jumpInput.Text)
    if jumpPower then
        customJumpPower = math.clamp(jumpPower, 0, 500)
        humanoid.UseJumpPower = true
        notify("ƒê√£ ƒë·∫∑t s·ª©c nh·∫£y: " .. customJumpPower)
    else
        notify("Vui l√≤ng nh·∫≠p s·ªë h·ª£p l·ªá cho s·ª©c nh·∫£y!")
    end
end)

-- Loop ƒë·ªÉ set WalkSpeed v√† JumpPower li√™n t·ª•c
speedJumpConnection = RunService.Heartbeat:Connect(function()
    if character and humanoid then
        humanoid.WalkSpeed = customWalkSpeed
        humanoid.JumpPower = customJumpPower
    end
end)

-- X·ª≠ l√Ω d·ªãch chuy·ªÉn
teleportButton.MouseButton1Click:Connect(function()
    local targetName = teleportInput.Text
    local targetPlayer = nil
    for _, p in pairs(Players:GetPlayers()) do
        if p.Name:lower():find(targetName:lower()) then
            targetPlayer = p
            break
        end
    end
    if targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") then
        rootPart.CFrame = targetPlayer.Character.HumanoidRootPart.CFrame + Vector3.new(0, 0, 2)
        notify("ƒê√£ d·ªãch chuy·ªÉn ƒë·∫øn: " .. targetPlayer.Name)
    else
        notify("Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi ch∆°i ho·∫∑c t√™n kh√¥ng h·ª£p l·ªá!")
    end
end)

-- X·ª≠ l√Ω xuy√™n t∆∞·ªùng
noclipToggle.MouseButton1Click:Connect(function()
    isNoClip = not isNoClip
    noclipToggle.Text = "Xuy√™n T∆∞·ªùng: " .. (isNoClip and "B·∫¨T" or "T·∫ÆT")
    
    if isNoClip then
        noclipConnection = RunService.Stepped:Connect(function()
            if character then
                for _, part in pairs(character:GetDescendants()) do
                    if part:IsA("BasePart") and part ~= rootPart then
                        part.CanCollide = false
                    end
                end
            end
        end)
        notify("ƒê√£ b·∫≠t Xuy√™n T∆∞·ªùng")
    else
        if noclipConnection then
            noclipConnection:Disconnect()
            noclipConnection = nil
        end
        if character then
            for _, part in pairs(character:GetDescendants()) do
                if part:IsA("BasePart") then
                    part.CanCollide = true
                end
            end
        end
        notify("ƒê√£ t·∫Øt Xuy√™n T∆∞·ªùng")
    end
end)

-- X·ª≠ l√Ω b·∫•t t·ª≠
godModeToggle.MouseButton1Click:Connect(function()
    isGodMode = not isGodMode
    godModeToggle.Text = "B·∫•t T·ª≠: " .. (isGodMode and "B·∫¨T" or "T·∫ÆT")
    
    if isGodMode then
        humanoid.MaxHealth = math.huge
        humanoid.Health = math.huge
        notify("ƒê√£ b·∫≠t B·∫•t T·ª≠")
    else
        humanoid.MaxHealth = 100
        humanoid.Health = 100
        notify("ƒê√£ t·∫Øt B·∫•t T·ª≠")
    end
end)

-- X·ª≠ l√Ω ESP Player/NPC (Box, Kho·∫£ng c√°ch m√†u c·∫ßu v·ªìng)
local function createEsp(target)
    local box = Drawing.new("Square")
    box.Visible = false
    box.Color = Color3.fromRGB(255, 255, 255)
    box.Thickness = 2
    box.Filled = false

    local distanceText = Drawing.new("Text")
    distanceText.Visible = false
    distanceText.Size = 16
    distanceText.Color = Color3.fromRGB(255, 255, 255)
    distanceText.Text = ""

    local connection = RunService.RenderStepped:Connect(function()
        if isESP and target and target.Parent and target:FindFirstChild("HumanoidRootPart") then
            local root = target.HumanoidRootPart
            local camera = workspace.CurrentCamera
            local screenPos, onScreen = camera:WorldToViewportPoint(root.Position)
            
            if onScreen then
                local size = (camera:WorldToViewportPoint(root.Position - Vector3.new(2, 3, 0)).Y - camera:WorldToViewportPoint(root.Position + Vector3.new(2, 3, 0)).Y) / 2
                box.Size = Vector2.new(size * 1.5, size * 2)
                box.Position = Vector2.new(screenPos.X - box.Size.X / 2, screenPos.Y - box.Size.Y / 2)
                box.Visible = true
                
                local distance = math.floor((rootPart.Position - root.Position).Magnitude)
                distanceText.Text = tostring(distance) .. "m"
                distanceText.Position = Vector2.new(screenPos.X, screenPos.Y - box.Size.Y / 2 - 20)
                distanceText.Visible = true
                
                -- M√†u c·∫ßu v·ªìng
                local hue = (tick() % 5) / 5
                distanceText.Color = Color3.fromHSV(hue, 1, 1)
            else
                box.Visible = false
                distanceText.Visible = false
            end
        else
            box.Visible = false
            distanceText.Visible = false
        end
    end)
    
    return {box = box, text = distanceText, connection = connection}
end

espToggle.MouseButton1Click:Connect(function()
    isESP = not isESP
    espToggle.Text = "ESP: " .. (isESP and "B·∫¨T" or "T·∫ÆT")
    
    if isESP then
        for _, p in pairs(Players:GetPlayers()) do
            if p ~= player and p.Character then
                espConnections[p] = createEsp(p.Character)
            end
        end
        for _, npc in pairs(workspace:GetDescendants()) do
            if npc:IsA("Model") and npc:FindFirstChild("Humanoid") and npc ~= player.Character then
                espConnections[npc] = createEsp(npc)
            end
        end
        notify("ƒê√£ b·∫≠t ESP Player/NPC")
    else
        for _, esp in pairs(espConnections) do
            esp.box:Remove()
            esp.text:Remove()
            esp.connection:Disconnect()
        end
        espConnections = {}
        notify("ƒê√£ t·∫Øt ESP Player/NPC")
    end
end)

-- X·ª≠ l√Ω Hitbox m·ªü r·ªông
local function expandHitbox(target)
    if target and target:FindFirstChild("HumanoidRootPart") then
        local root = target.HumanoidRootPart
        local hitboxPart = Instance.new("Part")
        hitboxPart.Size = root.Size * 3
        hitboxPart.Transparency = 0.5
        hitboxPart.CanCollide = false
        hitboxPart.Anchored = false
        hitboxPart.Parent = target
        local weld = Instance.new("WeldConstraint")
        weld.Part0 = root
        weld.Part1 = hitboxPart
        weld.Parent = hitboxPart
        return hitboxPart
    end
end

hitboxToggle.MouseButton1Click:Connect(function()
    isHitbox = not isHitbox
    hitboxToggle.Text = "Hitbox: " .. (isHitbox and "B·∫¨T" or "T·∫ÆT")
    
    if isHitbox then
        for _, p in pairs(Players:GetPlayers()) do
            if p ~= player and p.Character then
                hitboxParts[p] = expandHitbox(p.Character)
            end
        end
        for _, npc in pairs(workspace:GetDescendants()) do
            if npc:IsA("Model") and npc:FindFirstChild("Humanoid") and npc ~= player.Character then
                hitboxParts[npc] = expandHitbox(npc)
            end
        end
        notify("ƒê√£ b·∫≠t Hitbox m·ªü r·ªông cho Player/NPC")
    else
        for _, part in pairs(hitboxParts) do
            if part then part:Destroy() end
        end
        hitboxParts = {}
        notify("ƒê√£ t·∫Øt Hitbox m·ªü r·ªông")
    end
end)

-- X·ª≠ l√Ω ƒêi Tr√™n N∆∞·ªõc (Fix cho m·ªçi game, bao g·ªìm Blox Fruits)
waterWalkToggle.MouseButton1Click:Connect(function()
    isWaterWalk = not isWaterWalk
    waterWalkToggle.Text = "ƒêi Tr√™n N∆∞·ªõc: " .. (isWaterWalk and "B·∫¨T" or "T·∫ÆT")
    
    if isWaterWalk then
        -- T·∫°o platform v√¥ h√¨nh
        waterPlatform = Instance.new("Part")
        waterPlatform.Size = Vector3.new(10, 0.5, 10)
        waterPlatform.Transparency = 1
        waterPlatform.CanCollide = true
        waterPlatform.Anchored = true
        waterPlatform.Parent = workspace
        
        waterWalkConnection = RunService.Stepped:Connect(function()
            if character and rootPart and humanoid then
                -- Raycast ƒë·ªÉ t√¨m b·ªÅ m·∫∑t n∆∞·ªõc
                local rayParams = RaycastParams.new()
                rayParams.FilterDescendantsInstances = {character, waterPlatform}
                rayParams.FilterType = Enum.RaycastFilterType.Blacklist
                local ray = workspace:Raycast(rootPart.Position, Vector3.new(0, -10, 0), rayParams)
                
                local isOnWater = false
                local waterY = nil
                -- Ki·ªÉm tra Terrain.Water (cho Blox Fruits v√† game kh√°c)
                local cell = Terrain:WorldToCell(rootPart.Position)
                if Terrain:GetMaterialVoxels(cell.X, cell.Y, cell.Z).Material == Enum.Material.Water then
                    isOnWater = true
                    waterY = cell.Y * 4 + Terrain.WaterLevel -- ƒêi·ªÅu ch·ªânh theo Terrain
                elseif ray and ray.Instance and (ray.Instance.Name:lower():find("water") or ray.Instance.Name:lower():find("sea") or ray.Instance.Name:lower():find("ocean")) then
                    isOnWater = true
                    waterY = ray.Position.Y
                end
                
                if isOnWater and waterY then
                    -- ƒê·∫∑t platform d∆∞·ªõi ch√¢n
                    waterPlatform.Position = Vector3.new(rootPart.Position.X, waterY + 0.25, rootPart.Position.Z)
                    -- ƒêi·ªÅu ch·ªânh player
                    rootPart.Position = Vector3.new(rootPart.Position.X, waterY + 3, rootPart.Position.Z)
                    humanoid:ChangeState(Enum.HumanoidStateType.Running)
                    humanoid.Sit = false
                else
                    waterPlatform.Position = Vector3.new(0, -1000, 0) -- ·∫®n platform khi kh√¥ng c·∫ßn
                end
            end
        end)
        notify("ƒê√£ b·∫≠t ƒêi Tr√™n N∆∞·ªõc")
    else
        if waterWalkConnection then
            waterWalkConnection:Disconnect()
            waterWalkConnection = nil
        end
        if waterPlatform then
            waterPlatform:Destroy()
            waterPlatform = nil
        end
        notify("ƒê√£ t·∫Øt ƒêi Tr√™n N∆∞·ªõc")
    end
end)

-- X·ª≠ l√Ω nh√¢n v·∫≠t reset
player.CharacterAdded:Connect(function(newCharacter)
    character = newCharacter
    humanoid = character:WaitForChild("Humanoid")
    rootPart = character:WaitForChild("HumanoidRootPart")
    
    if isNoClip then
        for _, part in pairs(character:GetDescendants()) do
            if part:IsA("BasePart") and part ~= rootPart then
                part.CanCollide = false
            end
        end
    end
    if isGodMode then
        humanoid.MaxHealth = math.huge
        humanoid.Health = math.huge
    end
end)

-- Th√¥ng b√°o kh·ªüi ƒë·ªông
notify("Kirada Demo ƒë√£ t·∫£i! Ch·∫°m n√∫t üå≤ ƒë·ªÉ m·ªü menu.")
